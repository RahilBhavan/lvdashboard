# Risk Assessment & Mitigation Strategy: Deep Dive

## 1. The Risk Matrix Overview

| Risk Category | Scenario | Likelihood (1-5) | Impact (1-5) | Severity Score |
| :--- | :--- | :---: | :---: | :---: |
| **Market** | **Short Squeeze (Delta Neutral)** | 3 | 5 | **15 (Critical)** |
| **Market** | Stablecoin Depeg (>5%) | 2 | 5 | **10 (High)** |
| **Contract** | Rebalance Logic Bug (Infinite Loop) | 2 | 4 | **8 (High)** |
| **Operational** | Keeper/Automation Failure | 4 | 2 | **8 (Medium)** |
| **Systemic** | Oracle Latency/Freeze | 2 | 4 | **8 (Medium)** |
| **MEV** | Sandwich Attack on Rebalance | 5 | 3 | **15 (Critical)** |

---

## 2. Detailed Failure Scenarios & Engineering Defenses

### A. The "Short Squeeze" (Delta Neutral Failure)
*   **The Scenario:** The Vault is in **Mode C (Bear)**. It has borrowed ETH to hedge. Suddenly, ETH price doubles in 1 hour (e.g., ETF Approval news).
*   **The Danger:** The "Debt" (ETH) grows in value faster than the "Collateral" (USDC). The Health Factor drops rapidly toward 1.0. If liquidated by Aave, the Vault loses ~5-10% of equity instantly.
*   **Mitigation:**
    1.  **LTV Buffer:** We never borrow at max LTV. We target 60% LTV (Liquidation at 85%).
    2.  **Automation Priority:** The `checkHealthFactor()` function is prioritized by Gelato. If HF < 1.2, it triggers an **Emergency Repay**, selling collateral to close the debt *before* liquidation occurs.
    3.  **Soft Liquidation:** We allow whitelisted "Searchers" to liquidate our position at a 1% discount (cheaper than Aave's 5% penalty) if we fail to rebalance.

### B. The "Sandwich Attack" (MEV)
*   **The Scenario:** The Vault submits a transaction to swap $1M USDC for ETH to rebalance. A MEV bot sees this in the mempool. It buys ETH before us (pushing price up) and sells it after us.
*   **The Danger:** The Vault enters the position at a 1-2% worse price, effectively bleeding user funds every rebalance.
*   **Mitigation:**
    1.  **RPC Protection:** Transactions are sent via **Flashbots Protect** (private mempool), so bots literally cannot see the transaction until it is mined.
    2.  **Slippage Hardlines:** The off-chain model calculates the *exact* expected output. The smart contract enforces `minOutput` with a tight 0.5% tolerance. If the price moves more than that, the tx reverts.
    3.  **CowSwap Integration:** Using Batch Auctions means we execute at a uniform clearing price, making individual front-running impossible.

### C. Oracle Failure / Latency
*   **The Scenario:** Chainlink updates are delayed due to network congestion (e.g., during an NFT mint). The On-chain price is $2000, but the Real price is $1800.
*   **The Danger:** The model might try to rebalance into a "wrong" range, selling low or buying high based on stale data.
*   **Mitigation:**
    1.  **Price Band Check:** The contract checks `UniswapSpotPrice` vs. `ChainlinkOraclePrice`. If the deviation > 2%, the `rebalance()` reverts. We assume the market is too chaotic or one oracle is broken.
    2.  **Staleness Check:** If the Chainlink data is > 2 hours old, the contract rejects it.

### D. Stablecoin Depeg (USDC/USDT)
*   **The Scenario:** USDC falls to $0.90. The Vault holds 50% USDC.
*   **The Danger:** Massive loss of principal.
*   **Mitigation:**
    1.  **Circuit Breaker:** If the price of the stablecoin asset (relative to ETH or another stable) drops below $0.98, the **"Pause Guardian"** activates.
    2.  **Action:** All "Buy" actions are halted. The Vault enters "Withdraw Only" mode, allowing users to flee if they choose, but preventing the protocol from buying more of the de-pegged asset.

---

## 3. Operational Risks (Centralization)

### A. The "Black Box" Model Risk
*   **Concern:** "How do we know the off-chain Python model isn't just making random guesses?"
*   **Solution (ZK-Coprocessing):**
    *   We use **Brevis** to generate a ZK-Proof.
    *   The proof certifies: "This Output (Vector) was generated by Code Hash X using Input Data Y (which matches block headers)."
    *   This forces the off-chain computation to strictly follow the open-source algorithm.

### B. Admin Key Compromise
*   **Concern:** The deployer key could upgrade the contract and steal funds.
*   **Solution:**
    *   **TimeLock:** All upgrades have a 48-hour delay. Users can withdraw before changes take effect.
    *   **Multisig:** The `owner` is a 4-of-7 Gnosis Safe (Team + Investors + Community Members).

---

## 4. Insurance & Recovery

*   **Audit Strategy:**
    *   Two independent audits (e.g., Spearbit, Sherlock).
    *   Ongoing Bug Bounty ($50k on Immunefi).
*   **Insurance Fund:**
    *   10% of Protocol Revenue is diverted to a "Safety Module" (staked in Aave).
    *   This fund is used to reimburse users in the event of a smart contract exploit (not trading losses).
